<html lang="ko" 
    xmlns:th="http://www.thymeleaf.org" 
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    
		<header th:fragment="header">
			<div class="logo">
				<div>로고</div>
			</div>
			
			<!-- 카테고리 목록 -->
			<ul class="nav category flex-column" id="categoryList">
				<li class="category-list"><a href="/post/total-view">전체</a></li>
				<li class="category-list" th:each="category : ${categoryList}"><a href="/category/${category.name}" th:text="${category.name}"></a></li>
			</ul>
			
			<!-- 카테고리 추가 버튼 -->
			<button type="button" class="btn btn-secondary" id="categoryAddBtn" data-bs-toggle="modal" data-bs-target="#categoryAddModal">카테고리 +</button>
			
			<!-- 글 추가 버튼 -->
			<button type="button" class="btn btn-secondary" id="postAddBtn" data-bs-toggle="modal" data-bs-target="#postAddModal" onclick="openPostModal()">글 +</button>
			
			<!-- 카테고리 추가 모달 -->
			<div class="modal fade" id="categoryAddModal" tabindex="-1" aria-labelledby="categoryAddLabel" aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered">
				    <div class="modal-content">
				    	<div class="modal-header">
				        	<h4 class="modal-title" id="categoryAddLabel">카테고리 추가</h4>
				        	<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				     	</div>
				     	
				      	<div class="modal-body">
				       		<div class="fs-5">카테고리 이름</div>
				       		<input type="text" class="w-100 border-0 border-bottom mt-3" id="categoryTitleInput" placeholder="카테고리 이름을 입력하세요">
				      	</div>
				      
				      	<div class="modal-footer">
				        	<button type="button" class="btn" data-bs-dismiss="modal" style="background-color: #93B7BE;">취소</button>
				        	<button type="button" class="btn" id="categorySaveBtn" style="background-color: #2D3047; color: white;">확인</button>
				      	</div>
				    </div>
				</div>
			</div>
			
			<!-- 글 추가 모달 -->
			<div class="modal fade" id="postAddModal" tabindex="-1" aria-labelledby="postAddLabel" aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered modal-lg">
					<div class="modal-content">
				       
<!-- 추가한 부분 -->	
				       	<div class="modal-header">
				        	<h5 class="modal-title" id="postAddLabel">새 게시글 작성</h5>
				        	<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				     	</div>
				     	
				      	<div class="modal-body">
				      		<!-- 왼쪽 -->
				      		<div>
				      			<div class="dropdown">
								  <button class="btn btn-secondary dropdown-toggle" type="button" id="categorySelectButton" data-bs-toggle="dropdown" aria-expanded="false">
								    카테고리 선택
								  </button>
								  	<ul class="dropdown-menu" aria-labelledby="categorySelectButton">
								    	<li><a class="dropdown-item" href="#">카테고리1</a></li>
								    	<li class="dropdown-item" id="categoryId" th:each="category : ${categoryList}" th:text="${category.name}" name="categoryId" th:value="${category.id}"></li>
									</ul>
								</div>
				      		</div>
				      		
				      		<div class="d-flex">
				      			<div class="sub-content border col-4 d-flex justify-content-center flex-column">
				      				<img width="100px" class="mx-auto d-block" src="https://cdn.pixabay.com/photo/2020/11/22/11/53/sky-5766341_640.jpg">
				      				
				      				<div class="d-flex">
				      					<div class="bg-success w-50">간략한 내용 / DAY</div>
				      					<div class="bg-info w-50">N차 관람</div>
				      				</div>
				      				
				      				<div class="d-flex">
				      					<div class="bg-danger w-50">별점</div>
				      					<div class="bg-warning w-50">기분</div>
			      					</div>
				      			</div>
				      			
				      			<!-- 오른쪽 -->
					      		<div class="main-content border col-8">
					      			<input type="text" id="titleInput" placeholder="제목" class="col-8">
					      			<input type="text" placeholder="날짜" class="col-3">
					      			<textarea rows="2" class="form-control" id="contentInput" placeholder="내용"></textarea>
					      								      			
						      		<div class="d-flex">
						      			<div class="bg-info w-50">장소</div>
						      			<div class="bg-primary w-50">누구랑</div>
						      		</div>
					      		</div>
					      		
				      		</div>
				      	</div>
				      
				      	<div class="modal-footer">
				        	<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
				        	<button type="button" class="btn btn-primary" id="postSaveBtn">확인</button>
				      	</div>	
<!-- 추가한 부분 -->	
				       
					</div>
				</div>
			</div>
		</header>
		
		<script th:block th:fragment="script">		
		
		// 글 추가 모달 열기
		/* function openPostModal() {
			$('#postAddModal .modal-content').load("/post/create-view");
			$('#postAddModal').modal();
		} */
		
		$(document).ready(function() {
			
			$("#postSaveBtn").on("click", function() {
				
				let categoryId = $("#categoryId").val();
				let title = $("#titleInput").val();
				let content = $("#contentInput").val();
				
				if(title == "") {
					alert("제목을 입력하세요");
					return;
				}
				
				if(content == "") {
					alert("내용을 입력하세요");
					return;
				}
				
				$.ajax({
					type:"post"
					, url:"/post/create"
					, data: {"categoryId":categoryId, "title":title, "content":content}
					, success:function(response) {
						if(response.result == "success") {
							alert("게시 성공");
						} else {
							alert("게시 실패");
						}
					}
					, error:function() {
						alert("게시 에러");
					}
				});
			});
			
			$("#categorySaveBtn").on("click", function() {
				
				let categoryTitle = $("#categoryTitleInput").val();
				
				if(categoryTitle == "") {
					alert("카테고리 제목을 작성하세요");
					return;
				}
				
				$('#categoryAddBtn').on('click', function() {
	                $('#categoryTitleInput').val('');
	            });
				
				$('#categoryAddModal').modal('hide');
				
				$.ajax({
					type:"post"
					, url:"/category/create"
					, data:{"name":categoryTitle}
					, success:function(response) {
						if(response.result == "success") {
							location.reload();
						} else {
							alert("카테고리 생성 실패");
						}
					}
					, error:function() {
						alert("카테고리 생성 에러");
					}
				});
				
				
				
				
			});
		});
		</script>
</html>